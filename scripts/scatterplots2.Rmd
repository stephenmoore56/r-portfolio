---
title: "R Graphics - High-Density Scatterplots"
subtitle: "Solutions for Large Datasets and Overplotting"
author: "Stephen Moore"
date: "December 15, 2015"
output: 
    html_document:
        theme: default
        highlight: tango
---

### Introduction

This document demonstrates different ways of generating scatter plots for large datasets with the ggplot2 plotting package.  Plots make use of the diamonds dataset.

```{r init, warning=FALSE, message=FALSE}
library(knitr)
knitr::opts_chunk$set(tidy=T, 
               fig.width=8,
               fig.height=5,
               fig.align='left',
               warning=FALSE,
               message=FALSE,
               echo=TRUE)
options(width = 120)
library(ggplot2)
attach(diamonds)
```

### The Overplotting Problem

Standard scatterplots of large datasets are blobs that obscure structure in the data.

```{r overplotting1, tidy=F}
ggplot(diamonds,aes(x=carat,y=price)) + geom_point()
```

We can mitigate the problem somewhat by manipulating the alpha transparency of geom_point().

```{r overplotting2, tidy=F}
ggplot(diamonds,aes(x=carat,y=price)) + geom_point(alpha = 0.1)
```

### Better Solutions to Overplotting

Using contour lines or heatmaps can reveal structure in large, dense datasets.  In the case of these two variables from the diamonds dataset (price and carat), a log10 transform also helps to reveal the clusters and price points for standard carat weights of diamonds (1/4, 1/2, 1, 1.5, 2, 3).

```{r overplotting3, tidy=F}
ggplot(diamonds,aes(x=log10(carat),y=log10(price))) + 
  geom_point(alpha = 0.1, colour="orange") + 
  geom_density2d()+ theme_bw()
ggplot(diamonds,aes(x=log10(carat),y=log10(price))) + 
  stat_binhex()
ggplot(diamonds,aes(x=log10(carat),y=log10(price))) + 
  stat_binhex(colour="white", na.rm=TRUE) +
  scale_fill_gradientn(colours=c("blue","orange"), name = "Frequency", na.value=NA) + 
  theme_bw()
```
```{r smoothedScatterplot, tidy=F}

# create a color palette to use in smoothed scatterplot
library(RColorBrewer)
buylrd = c("#313695", "#4575B4", "#74ADD1", "#ABD9E9", "#E0F3F8", "#FFFFBF",
           "#FEE090", "#FDAE61", "#F46D43", "#D73027", "#A50026") 
myColRamp = colorRampPalette(c(buylrd))

# smoothed scatterplot
smoothScatter(x=log10(carat),y=log10(price),
              colramp=myColRamp)
```

### Programming Environment

```{r}
sessionInfo()
```


